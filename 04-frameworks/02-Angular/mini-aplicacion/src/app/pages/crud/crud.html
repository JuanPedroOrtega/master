<div class="crud-container">
  <h1>Gestión de Contactos</h1>

  <mat-card class="form-card">
    <mat-card-header>
      <mat-card-title>
        @if (editingId !== null) {
          Editar Contacto
        } @else {
          Nuevo Contacto
        }
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="contactForm" (ngSubmit)="onSubmit()" class="contact-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="nombre" placeholder="Nombre completo">
          @if (contactForm.get('nombre')?.invalid && contactForm.get('nombre')?.touched) {
            <mat-error>{{ getErrorMessage('nombre') }}</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Email</mat-label>
          <input matInput type="email" formControlName="email" placeholder="ejemplo@correo.com">
          @if (contactForm.get('email')?.invalid && contactForm.get('email')?.touched) {
            <mat-error>{{ getErrorMessage('email') }}</mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Teléfono</mat-label>
          <input matInput formControlName="telefono" placeholder="9 dígitos (opcional)">
          @if (contactForm.get('telefono')?.invalid && contactForm.get('telefono')?.touched) {
            <mat-error>{{ getErrorMessage('telefono') }}</mat-error>
          }
        </mat-form-field>

        <div class="form-actions">
          @if (editingId !== null) {
            <button mat-raised-button color="primary" type="submit" [disabled]="contactForm.invalid">
              <mat-icon>save</mat-icon>
              Actualizar
            </button>
            <button mat-raised-button type="button" (click)="cancelEdit()">
              <mat-icon>cancel</mat-icon>
              Cancelar
            </button>
          } @else {
            <button mat-raised-button color="primary" type="submit" [disabled]="contactForm.invalid">
              <mat-icon>add</mat-icon>
              Agregar
            </button>
          }
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <mat-card class="list-card">
    <mat-card-header>
      <mat-card-title>Lista de Contactos ({{ filteredContacts.length }})</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div class="filter-section">
        <mat-checkbox [(ngModel)]="hideWithoutPhone">
          Ocultar contactos sin teléfono
        </mat-checkbox>
      </div>

      @if (filteredContacts.length === 0) {
        <div class="empty-state">
          <mat-icon>contacts</mat-icon>
          <p>No hay contactos para mostrar</p>
        </div>
      } @else {
        <mat-list>
          @for (contact of filteredContacts; track contact.id) {
            <mat-list-item class="contact-item">
              <div class="contact-info">
                <h3>{{ contact.nombre }}</h3>
                <p class="email">{{ contact.email }}</p>
                @if (contact.telefono) {
                  <p class="phone">
                    <mat-icon>phone</mat-icon>
                    {{ contact.telefono }}
                  </p>
                } @else {
                  <p class="no-phone">
                    <mat-icon>phone_disabled</mat-icon>
                    Sin teléfono
                  </p>
                }
              </div>
              <div class="contact-actions">
                <button mat-icon-button color="primary" (click)="editContact(contact)" title="Editar">
                  <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="deleteContact(contact.id)" title="Eliminar">
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
            </mat-list-item>
          }
        </mat-list>
      }
    </mat-card-content>
  </mat-card>
</div>
